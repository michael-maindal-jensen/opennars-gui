<!-- Import JavaScript Libraries. -->
<html>
    <head>
        <script type="text/javascript" src="web_socket.js"></script>
        <script type="text/javascript" src="lib/jquery/dist/jquery.min.js"></script>
        <script type="text/javascript" src="lib/jquery-ui/ui/minified/jquery-ui.min.js"></script>
        <script type="text/javascript" src="lib/jquery.terminal/js/jquery.terminal-min.js"></script>
        <script type="text/javascript" src="lib/lodash/dist/lodash.min.js"></script>
        <style type="text/css">
            @import url("lib/jquery-ui/themes/dot-luv/jquery-ui.min.css");
            @import url("lib/jquery-ui/themes/dot-luv/jquery.ui.theme.css");
            @import url("lib/jquery.terminal/css/jquery.terminal.css");
            @import url("index.css");
        </style>
        <style>
        </style>
            
    </head>
    <body>
        <div id="io">
            
        </div>
        
        <script type="text/javascript">
            var ws = new WebSocket('ws://localhost:8887');
            
            var prevOutput = null, currentOutput = null;
            
            function getLineClass(m) {
                if ((m[0] == '\"') && (m[m.length-1] == '\"'))
                    return 'comment';
                if (m.trim().indexOf('IN:') == 0)
                    return 'in';
                if (m.trim().indexOf('OUT') == 0)
                    return 'out';
                return null;
            }
            function addIO(message) {
                var d = $('<div/>').addClass('section');

                prevOutput = currentOutput;
        
                if (message && typeof message == "string") {
                    d.append(message + '<br/>'); 
                    currentOutput = d;
                }
                else{
                    var input = $('<textarea/>');                
                    var outputDiv = $('<div/>').addClass('output');
                    var sendButton = $('<button/>').html('&gt;').click(function() {
                        try {                            
                            ws.send(input.val());
                            input.attr('editable', 'false');
                            addIO();
                        } catch (e) {
                            output('Error: ' + e);
                        }

                    });


                    d.append(input);
                    d.append(sendButton);
                    d.append(outputDiv);                    
                    currentOutput = outputDiv;
                }
                $('#io').append(d);
                scrollbottom();
            }
            function scrollbottom() {                    
                $('body').scrollTop($('body').prop('scrollHeight'));
            }
            function output(m, monospace) {
                if (!prevOutput)
                    prevOutput = currentOutput;
                if (monospace) {
                    var l = $("<pre>" + m + '</pre>\n');
                    var lc = getLineClass(m);
                    if (lc)
                        l.addClass(lc);
                    prevOutput.append(l);
                }
                else 
                    prevOutput.append("<span>" + m + '</span>\n');
                scrollbottom();
            }
            $(document).ready(function() {
                addIO("<b>OpenNARS: </b><br/>");
                
                ws.onopen = function() {
                    output("Connected.");
                    addIO();
                };
                ws.onmessage = function(e) {
                    e.data.split("\n").forEach(function(l) { output(l, true); } )
                };
                ws.onclose = function() {
                    output("Disconnected.");
                };
    
            });
                



        </script>
    </body>
</html>
