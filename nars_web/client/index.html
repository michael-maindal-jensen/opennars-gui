<!-- Import JavaScript Libraries. -->
<html>
    <head>
        <script type="text/javascript" src="web_socket.js"></script>
        <script type="text/javascript" src="lib/jquery/dist/jquery.min.js"></script>
        <script type="text/javascript" src="lib/jquery-ui/ui/minified/jquery-ui.min.js"></script>
        <script type="text/javascript" src="lib/jquery.terminal/js/jquery.terminal-min.js"></script>
        <script type="text/javascript" src="lib/lodash/dist/lodash.min.js"></script>
        <style type="text/css">
            @import url("lib/jquery-ui/themes/dot-luv/jquery-ui.min.css");
            @import url("lib/jquery-ui/themes/dot-luv/jquery.ui.theme.css");
            @import url("lib/jquery.terminal/css/jquery.terminal.css");
            @import url("index.css");
        </style>
        <style>
            #menu {
                position: fixed;
                left: 0;
                top: 0;
                background-color: rgba(225,225,225,0.9);
                width: 100%;
                padding: 5px;
                font-size: 150%;
            }
            #menu button {
                vertical-align:top;
            }
            #io {
                padding-top: 1.8em;
            }
        </style>
            
    </head>
    <body>
        <div id="menu">
            OpenNARS
            <button id="pauseButton">|| Pause</button>
            <button id="playButton">|&gt; Run</button>
        </div>
        
        <div id="io">
            
        </div>
        
        <script type="text/javascript">
            
            var websocketPort = 10000;
            var ws = new WebSocket('ws://' + window.location.hostname + ':' + websocketPort);
            
            var prevOutput = null, currentOutput = null;
            
            function getLineClass(m) {
                if ((m[0] == '\"') && (m[m.length-1] == '\"'))
                    return 'comment';
                if (m.trim().indexOf('IN:') == 0)
                    return 'in';
                if (m.trim().indexOf('OUT') == 0)
                    return 'out';
                return null;
            }
            function addIO(message) {
                var d = $('<div/>').addClass('section');

                prevOutput = currentOutput;
        
                if (message && typeof message == "string") {
                    d.append(message + '<br/>'); 
                    currentOutput = d;
                }
                else{
                    var input = $('<textarea/>'); 
   
                    var outputDiv = $('<div/>').addClass('output');
                    var sendButton = $('<button/>').html('&gt;').click(function() {
                        try {                            
                            ws.send(input.val());
                            input.attr('editable', 'false');
                            addIO();
                        } catch (e) {
                            output('Error: ' + e);
                        }

                    });
                    input.keydown(function (e) {
                        if (e.ctrlKey && e.keyCode == 13) {
                            sendButton.click();
                        }
                    });
                    d.append(input);
                    d.append(sendButton);
                    d.append(outputDiv);                    
                    currentOutput = outputDiv;
                }
                $('#io').append(d);
                scrollbottom();
            }
            function scrollbottom() {                    
                $('body').scrollTop($('body').prop('scrollHeight'));
            }
            function output(m, monospace) {
                if (!prevOutput)
                    prevOutput = currentOutput;
                if (monospace) {
                    var l = $("<pre/>");
                    l.text(m);
                    var lc = getLineClass(m);
                    if (lc)
                        l.addClass(lc);
                    prevOutput.append(l);
                }
                else 
                    prevOutput.append("<span>" + m + '</span>\n');
                scrollbottom();
            }
            //addIO("Starting...");
            
            $(document).ready(function() {                
                ws.onopen = function() {
                    addIO("Connected.");
                    addIO();
                };
                ws.onmessage = function(e) {
                    e.data.split("\n").forEach(function(l) { output(l, true); } )
                };
                ws.onclose = function() {
                    output("Disconnected.");
                };
    
            });
            
            $('#pauseButton').click(function() {
                ws.send('*stop');
            });
            $('#playButton').click(function() {
                ws.send('*start');
            });
            


        </script>
    </body>
</html>
